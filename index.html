<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ê°€í”¼ ì™€ì¸ ì œì¡°ê´€ë¦¬ ì‹œìŠ¤í…œ v11.8</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        
        .version-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-top: 5px;
        }
        
        .connection-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }
        
        .status-online { background: #10b981; color: white; }
        .status-offline { background: #ef4444; color: white; }
        
        .auto-save-indicator {
            position: absolute;
            top: 60px;
            right: 20px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 11px;
            background: rgba(255,255,255,0.2);
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .auto-save-indicator.show { opacity: 1; }
        
        .tabs {
            display: flex;
            background: #f1f5f9;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        
        .form-group { margin-bottom: 20px; }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #334155;
            font-size: 14px;
        }
        
        .input-with-button {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-with-button input { flex: 1; }
        
        .quick-btn {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .quick-btn:hover { background: #667eea; color: white; }
        
        .quick-select-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .quick-select-btn {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: #334155;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .quick-select-btn:hover {
            border-color: #667eea;
            background: #f8fafc;
            transform: translateY(-2px);
        }
        
        .quick-select-btn.selected {
            border-color: #667eea;
            background: #f1f5f9;
            color: #667eea;
        }
        
        .price-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .price-btn {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: #334155;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .price-btn:hover {
            border-color: #667eea;
            background: #f8fafc;
            transform: translateY(-2px);
        }
        
        .price-btn.selected {
            border-color: #10b981;
            background: #10b981;
            color: white;
            box-shadow: 0 5px 15px rgba(16,185,129,0.3);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102,126,234,0.3);
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
            margin-left: 10px;
        }
        
        .btn-secondary:hover { background: #475569; }
        
        .btn-success {
            background: #10b981;
            color: white;
            margin-left: 10px;
        }
        
        .btn-success:hover { background: #059669; }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .btn-danger:hover { background: #dc2626; }
        
        .photo-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .photo-upload:hover {
            border-color: #667eea;
            background: #f8fafc;
        }
        
        .photo-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 10px auto;
            border-radius: 10px;
            display: none;
        }
        
        .photo-preview.show { display: block; }
        
        /* ìƒ‰ìƒ/êµ¬ì—­ ê·¸ë¦¬ë“œ 50% ì¶•ì†Œ */
        .color-tapes {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .color-tape {
            padding: 10px 8px;
            border: 2px solid transparent;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .color-tape:hover { transform: translateY(-2px); }
        
        .color-tape.selected {
            border-color: #1e293b;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .warehouse-zones {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .warehouse-zone {
            padding: 10px 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            background: white;
            transition: all 0.3s;
        }
        
        .warehouse-zone:hover {
            transform: translateY(-2px);
            border-color: #667eea;
        }
        
        .warehouse-zone.selected {
            border-color: #667eea;
            background: #f1f5f9;
            box-shadow: 0 3px 10px rgba(102,126,234,0.2);
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
        }
        
        tr:hover { background: #f8fafc; }
        
        .product-photo-small {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .manufacturing-list { margin-top: 30px; }
        
        .manufacturing-item {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        
        .manufacturing-item:hover {
            border-color: #667eea;
            background: #f8fafc;
            transform: translateX(5px);
        }
        
        .item-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .item-info {
            flex: 1;
            cursor: pointer;
        }
        
        .item-info h4 {
            margin-bottom: 5px;
            color: #1e293b;
        }
        
        .item-info p {
            font-size: 12px;
            color: #64748b;
            margin: 2px 0;
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success { border-left: 4px solid #10b981; }
        .notification.error { border-left: 4px solid #ef4444; }
        
        .export-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .summary-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .summary-card .value {
            font-size: 28px;
            font-weight: 700;
        }
        
        .haccp-section { margin-bottom: 20px; }
        
        @media (max-width: 768px) {
            .color-tapes,
            .warehouse-zones {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .quick-select-buttons {
                grid-template-columns: 1fr;
            }
            
            .price-buttons {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 8px;
            }
            
            .export-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }
        
        /* ğŸ” ë¡œê·¸ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .login-box h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .login-box p {
            color: #64748b;
            margin-bottom: 30px;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            letter-spacing: 3px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .login-error {
            color: #ef4444;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        
        .login-logo {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .login-footer {
            margin-top: 20px;
            font-size: 12px;
            color: #94a3b8;
        }

    </style>
</head>
<body>
    
    <!-- ğŸ” ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-logo">ğŸ·</div>
            <h2>OGAPIRO WINE</h2>
            <p>ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            
            <input 
                type="password" 
                id="adminCode" 
                class="login-input" 
                placeholder="ê´€ë¦¬ì ì½”ë“œ"
                maxlength="20"
                autocomplete="off"
            >
            
            <button class="login-btn" onclick="checkAdminCode()">
                ğŸ”“ ë¡œê·¸ì¸
            </button>
            
            <div id="loginError" class="login-error">
                âŒ ê´€ë¦¬ì ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤
            </div>
            
            <div class="login-footer">
                ì¬ê³ ê´€ë¦¬ ì‹œìŠ¤í…œ v11.25
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ· ì˜¤ê°€í”¼ ì™€ì¸ ì œì¡°ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <div class="version-badge">v11.25 Admin Code Login</div>
            <div class="connection-status" id="connectionStatus">ğŸ“¡ ì—°ê²° ì¤‘...</div>
            <div class="auto-save-indicator" id="autoSaveIndicator">ğŸ’¾ ìë™ì €ì¥ ì¤‘...</div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('manufacturing')">ğŸ“‹ ì œì¡°ê´€ë¦¬ëŒ€ì¥</button>
            <button class="tab" onclick="switchTab('inbound')">ğŸ“¥ ì…ê³ ë“±ë¡</button>
            <button class="tab" onclick="switchTab('outbound')">ğŸ“¤ ì¶œê³ ë“±ë¡</button>
            <button class="tab" onclick="switchTab('inventory')">ğŸ“Š ì¬ê³ í˜„í™©</button>
            <button class="tab" onclick="switchTab('haccp')">âœ… HACCPì ê²€í‘œ</button>
        </div>
        
        <!-- ì œì¡°ê´€ë¦¬ëŒ€ì¥ íƒ­ -->
        <div id="manufacturing" class="tab-content active">
            <h2>ğŸ“‹ ì œì¡°ê´€ë¦¬ëŒ€ì¥</h2>
            
            <div class="form-group">
                <label>ì œì¡°ë²ˆí˜¸ (ì›í´ë¦­ ì…ë ¥) *</label>
                <div class="input-with-button">
                    <input type="text" id="mfgNumber" placeholder="ì˜ˆ: HE-OGP-260212-01" required>
                    <button class="quick-btn" onclick="quickFillMfgNumber()">HE-OGP-260212-01</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>ì œì¡°ì¼ì *</label>
                <input type="date" id="mfgDate" required>
            </div>
            
            <div class="form-group">
                <label>ìƒí’ˆëª… + ìš©ëŸ‰ (ë¹ ë¥¸ ì„ íƒ) *</label>
                <input type="text" id="mfgProductName" placeholder="ìƒí’ˆëª… ì…ë ¥ ë˜ëŠ” ì•„ë˜ ë²„íŠ¼ í´ë¦­" required>
                <div class="quick-select-buttons">
                    <button class="quick-select-btn" onclick="quickSelectProduct('ì˜¤ê°€í”¼ë¡œ í”„ë¦¬ë¯¸ì—„', '750ml')">ğŸ· ì˜¤ê°€í”¼ë¡œ í”„ë¦¬ë¯¸ì—„ 750ml</button>
                    <button class="quick-select-btn" onclick="quickSelectProduct('ì˜¤ê°€í”¼ë¡œ í´ë˜ì‹', '500ml')">ğŸ· ì˜¤ê°€í”¼ë¡œ í´ë˜ì‹ 500ml</button>
                    <button class="quick-select-btn" onclick="quickSelectProduct('ì˜¤ê°€í”¼ë¡œ ìŠ¤íƒ ë‹¤ë“œ', '375ml')">ğŸ· ì˜¤ê°€í”¼ë¡œ ìŠ¤íƒ ë‹¤ë“œ 375ml</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>ìš©ëŸ‰ *</label>
                <input type="text" id="mfgVolume" placeholder="ìë™ ì…ë ¥ë¨" required>
            </div>
            
            <div class="form-group">
                <label>ì œí’ˆ ì‚¬ì§„ ğŸ“¸</label>
                <div class="photo-upload" onclick="document.getElementById('mfgPhoto').click()">
                    <p>ğŸ“· í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì—…ë¡œë“œ</p>
                    <img id="mfgPhotoPreview" class="photo-preview" alt="ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°">
                    <input type="file" id="mfgPhoto" accept="image/*" style="display:none;" onchange="handleMfgPhotoUpload(event)">
                </div>
            </div>
            
            <div class="form-group">
                <label>ìƒì‚°ìˆ˜ëŸ‰(ë³‘) *</label>
                <input type="number" id="mfgQuantity" placeholder="ì˜ˆ: 100" required>
            </div>
            
            <div class="form-group">
                <label>ì›ì¬ë£Œ ë°°ì¹˜ë²ˆí˜¸</label>
                <div class="input-with-button">
                    <input type="text" id="mfgRawBatch" placeholder="ì˜ˆ: OGP-260212-A">
                    <button class="quick-btn" onclick="quickFillRawBatch()">OGP-260212-A</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>ì•Œì½”ì˜¬(%)</label>
                <input type="text" id="mfgAlcohol" placeholder="ì˜ˆ: 13%">
            </div>
            
            <div class="form-group">
                <label>ë³‘ì…ì¼</label>
                <input type="date" id="mfgBottlingDate">
            </div>
            
            <div class="form-group">
                <label>ì†Œë¹„ê¸°í•œ</label>
                <input type="date" id="mfgExpiryDate">
            </div>
            
            <div class="form-group">
                <label>ë¹„ê³ </label>
                <textarea id="mfgNote" placeholder="ì¶”ê°€ ì •ë³´ ì…ë ¥..."></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="saveManufacturing()">
                <span id="mfgBtnText">ğŸ“‹ ì œì¡° ë“±ë¡</span>
            </button>
            <button class="btn btn-secondary" onclick="resetManufacturingForm()">ğŸ”„ ì´ˆê¸°í™”</button>
            
            <div class="manufacturing-list">
                <h3>ë“±ë¡ëœ ì œì¡° ë¦¬ìŠ¤íŠ¸</h3>
                <div id="manufacturingListContainer"></div>
            </div>
        </div>
        
        <!-- ì…ê³ ë“±ë¡ íƒ­ -->
        <div id="inbound" class="tab-content">
            <h2>ğŸ“¥ ì…ê³ ë“±ë¡</h2>
            
            <div class="form-group">
                <label>ìƒí’ˆ ì„ íƒ *</label>
                <select id="inboundProduct" onchange="loadProductPhoto()">
                    <option value="">-- ì œì¡°ëœ ìƒí’ˆ ì„ íƒ --</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ì œí’ˆ ì‚¬ì§„</label>
                <img id="inboundPhotoPreview" class="photo-preview" alt="ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°">
            </div>
            
            <div class="form-group">
                <label>ë°°ì¹˜ë²ˆí˜¸</label>
                <div class="input-with-button">
                    <input type="text" id="inboundBatch" placeholder="ì˜ˆ: OGP-260212-A">
                    <button class="quick-btn" onclick="quickFillBatchNumber()">OGP-260212-A</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>ìƒ‰ìƒ í…Œì´í”„ ì„ íƒ * (ì¶•ì†Œ)</label>
                <div class="color-tapes">
                    <div class="color-tape" style="background: #3b82f6; color: white;" onclick="selectColor('íŒŒë‘')">ğŸ”µ</div>
                    <div class="color-tape" style="background: #22c55e; color: white;" onclick="selectColor('ì´ˆë¡')">ğŸŸ¢</div>
                    <div class="color-tape" style="background: #eab308; color: white;" onclick="selectColor('ë…¸ë‘')">ğŸŸ¡</div>
                    <div class="color-tape" style="background: #ef4444; color: white;" onclick="selectColor('ë¹¨ê°•')">ğŸ”´</div>
                    <div class="color-tape" style="background: #a855f7; color: white;" onclick="selectColor('ë³´ë¼')">ğŸŸ£</div>
                    <div class="color-tape" style="background: #f97316; color: white;" onclick="selectColor('ì£¼í™©')">ğŸŸ </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>ì°½ê³  êµ¬ì—­ ì„ íƒ * (ì¶•ì†Œ)</label>
                <div class="warehouse-zones">
                    <div class="warehouse-zone" onclick="selectZone('Aêµ¬ì—­')">A</div>
                    <div class="warehouse-zone" onclick="selectZone('Bêµ¬ì—­')">B</div>
                    <div class="warehouse-zone" onclick="selectZone('Cêµ¬ì—­')">C</div>
                    <div class="warehouse-zone" onclick="selectZone('Dêµ¬ì—­')">D</div>
                    <div class="warehouse-zone" onclick="selectZone('Eêµ¬ì—­')">E</div>
                    <div class="warehouse-zone" onclick="selectZone('Fêµ¬ì—­')">F</div>
                </div>
            </div>
            
            <div class="form-group">
                <label>ìˆ˜ëŸ‰(ë³‘) *</label>
                <input type="number" id="inboundQuantity" placeholder="ì…ê³  ìˆ˜ëŸ‰ ì…ë ¥" required>
            </div>
            
            <div class="form-group">
                <label>ë¹„ê³  (ì‹ ê·œ)</label>
                <textarea id="inboundNote" placeholder="ì¶”ê°€ ì •ë³´ ì…ë ¥..."></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="saveInbound()">ğŸ“¥ ì…ê³  ë“±ë¡</button>
            <button class="btn btn-secondary" onclick="resetInboundForm()">ğŸ”„ ì´ˆê¸°í™”</button>
            
            <div class="manufacturing-list">
                <h3>ì…ê³  ì´ë ¥</h3>
                <div id="inboundListContainer"></div>
            </div>
        </div>
        
        <!-- ì¶œê³ ë“±ë¡ íƒ­ -->
        <div id="outbound" class="tab-content">
            <h2>ğŸ“¤ ì¶œê³ ë“±ë¡</h2>
            
            <div class="form-group">
                <label>ì¶œê³  ë°°ì¹˜ ì„ íƒ *</label>
                <select id="batchSelect" onchange="selectBatchFromDropdown()">
                    <option value="">-- ì¬ê³ ê°€ ìˆëŠ” ë°°ì¹˜ ì„ íƒ --</option>
                </select>
                <div id="selectedBatchInfo" style="margin-top: 10px; padding: 10px; background: #f1f5f9; border-radius: 8px; display: none;">
                    <p style="font-size: 13px; color: #334155;"><strong>ì„ íƒëœ ë°°ì¹˜:</strong> <span id="selectedBatchName"></span></p>
                    <p style="font-size: 12px; color: #64748b;">ì¬ê³ : <span id="selectedBatchStock"></span>ë³‘</p>
                </div>
            </div>
            
            <div class="form-group">
                <label>ì¶œê³ ìˆ˜ëŸ‰(ë³‘) *</label>
                <input type="number" id="outboundQuantity" placeholder="ì¶œê³  ìˆ˜ëŸ‰ ì…ë ¥" oninput="calculateOutboundTotal()" required>
            </div>
            
            <div class="form-group">
                <label>ì¶œê³  ëŒ€ìƒ ì´ë¦„ *</label>
                <input type="text" id="outboundTarget" placeholder="ì˜ˆ: ê¹€ê³ ê°" required>
            </div>
            
            <div class="form-group">
                <label>ì¶œê³ ê°€(ì›/ë³‘) *</label>
                <input type="number" id="outboundPrice" placeholder="ì¶œê³ ê°€ ì…ë ¥ ë˜ëŠ” ì•„ë˜ ë²„íŠ¼ í´ë¦­" oninput="calculateOutboundTotal()" required>
                <div class="price-buttons">
                    <button class="price-btn" onclick="selectPrice(38000)">ğŸ’° 38,000ì›</button>
                    <button class="price-btn" onclick="selectPrice(25000)">ğŸ’° 25,000ì›</button>
                    <button class="price-btn" onclick="selectPrice(17000)">ğŸ’° 17,000ì›</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>ì¶œê³ ê°€ ì´ì•¡</label>
                <input type="text" id="outboundTotal" readonly placeholder="0ì›">
            </div>
            
            <div class="form-group">
                <label>ë¹„ê³  (ì‹ ê·œ)</label>
                <textarea id="outboundNote" placeholder="ì¶œê³  ê´€ë ¨ ë¹„ê³  ì…ë ¥..."></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="saveOutbound()">ğŸ“¤ ì¶œê³  ë“±ë¡</button>
            
            <div class="manufacturing-list">
                <h3>ì¶œê³  ì´ë ¥</h3>
                <div id="outboundListContainer"></div>
            </div>
        </div>
        
        <!-- ì¬ê³ í˜„í™© íƒ­ -->
        <div id="inventory" class="tab-content">
            <h2>ğŸ“Š ì¬ê³ í˜„í™©</h2>
            
            <div class="summary-cards">
                <div class="summary-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    <h3>ğŸ“¦ ì´ ì…ê³ ìˆ˜ëŸ‰</h3>
                    <div class="value" id="summaryInbound">0ë³‘</div>
                </div>
                <div class="summary-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <h3>âœ… í˜„ì¬ ì¬ê³ </h3>
                    <div class="value" id="summaryStock">0ë³‘</div>
                </div>
                <div class="summary-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    <h3>ğŸ“¤ ì´ ì¶œê³ ìˆ˜ëŸ‰</h3>
                    <div class="value" id="summaryOutbound">0ë³‘</div>
                </div>
                <div class="summary-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <h3>ğŸ’° íŒë§¤ì´ì•¡</h3>
                    <div class="value" id="summarySales">0ì›</div>
                </div>
            </div>
            
            <div class="export-section">
                <div>
                    <h3 style="margin-bottom: 5px;">ğŸ“‹ ì „ì²´ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                    <p style="font-size: 13px; color: #64748b;">ì œì¡°ê´€ë¦¬, ì…ê³ , ì¶œê³ , ì¬ê³ , HACCP ë°ì´í„°ë¥¼ Excel íŒŒì¼ë¡œ ì €ì¥</p>
                </div>
                <button class="btn btn-success" onclick="exportToExcel()">ğŸ“Š ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ì‚¬ì§„</th>
                            <th>ìƒí’ˆëª…</th>
                            <th>ì œì¡°ë²ˆí˜¸</th>
                            <th>ë°°ì¹˜ë²ˆí˜¸</th>
                            <th>ì…ê³ ìˆ˜ëŸ‰</th>
                            <th>í˜„ì¬ê³ </th>
                            <th>ì¶œê³ ìˆ˜ëŸ‰</th>
                            <th>ì¶œê³ ëŒ€ìƒ</th>
                            <th>íŒë§¤ì´ì•¡</th>
                            <th>ì…ê³ ì¼</th>
                            <th>ìƒ‰ìƒ/êµ¬ì—­</th>
                            <th>ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryBody">
                        <tr>
                            <td colspan="12" style="text-align: center; padding: 30px;">ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- HACCP ì ê²€í‘œ íƒ­ -->
        <div id="haccp" class="tab-content">
            <h2>âœ… HACCP ì ê²€í‘œ</h2>
            
            <div class="haccp-section">
                <div class="form-group">
                    <label>ì ê²€ì¼ *</label>
                    <input type="date" id="haccpDate" required>
                </div>
                
                <div class="form-group">
                    <label>ê³µì •ë‹¨ê³„ *</label>
                    <select id="haccpStage">
                        <option value="ë°œíš¨ê³µì •">ë°œíš¨ê³µì •</option>
                        <option value="ìˆ™ì„±ê³µì •">ìˆ™ì„±ê³µì •</option>
                        <option value="ì—¬ê³¼ê³µì •">ì—¬ê³¼ê³µì •</option>
                        <option value="ë³‘ì…ê³µì •">ë³‘ì…ê³µì •</option>
                        <option value="í¬ì¥ê³µì •">í¬ì¥ê³µì •</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ì ê²€í•­ëª© *</label>
                    <select id="haccpItem">
                        <option value="ì˜¨ë„ê´€ë¦¬">ì˜¨ë„ê´€ë¦¬</option>
                        <option value="ìœ„ìƒê´€ë¦¬">ìœ„ìƒê´€ë¦¬</option>
                        <option value="ì„¤ë¹„ì ê²€">ì„¤ë¹„ì ê²€</option>
                        <option value="ì›ë£Œê´€ë¦¬">ì›ë£Œê´€ë¦¬</option>
                        <option value="ê¸°ë¡ê´€ë¦¬">ê¸°ë¡ê´€ë¦¬</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ê¸°ì¤€ * (ë¹ ë¥¸ ì…ë ¥)</label>
                    <div class="input-with-button">
                        <input type="text" id="haccpStandard" placeholder="ì˜ˆ: 18~22Â°C ìœ ì§€" required>
                        <button class="quick-btn" onclick="quickFillHACCPStandard()">18~22Â°C ìœ ì§€</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì ê²€ê²°ê³¼ *</label>
                    <select id="haccpResult">
                        <option value="ì í•©">âœ… ì í•©</option>
                        <option value="ë¶€ì í•©">âŒ ë¶€ì í•©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ì¡°ì¹˜ì‚¬í•­</label>
                    <textarea id="haccpAction" placeholder="ë¶€ì í•© ì‹œ ì¡°ì¹˜ë‚´ìš© ì…ë ¥..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>ì ê²€ì *</label>
                    <input type="text" id="haccpInspector" placeholder="ì ê²€ì ì´ë¦„" required>
                </div>
                
                <button class="btn btn-primary" onclick="saveHACCP()">
                    <span id="haccpBtnText">âœ… ì ê²€ ë“±ë¡</span>
                </button>
                <button class="btn btn-secondary" onclick="resetHACCPForm()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
            
            <div class="manufacturing-list">
                <h3>HACCP ì ê²€ ì´ë ¥</h3>
                <div id="haccpListContainer"></div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCuCpu2TAmCYjIceiyIKLHu1Nyav8DQde4",
            authDomain: "ogapiro-wine.firebaseapp.com",
            databaseURL: "https://ogapiro-wine-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ogapiro-wine",
            storageBucket: "ogapiro-wine.firebasestorage.app",
            messagingSenderId: "605743153867",
            appId: "1:605743153867:web:d1ab2869dac0190e43114e",
            measurementId: "G-3252DV3DNB"
        };
        
        let isFirebaseEnabled = true;
        let db = null;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            isFirebaseEnabled = true;
            updateConnectionStatus(true);
            
            // ğŸ”¥ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ë¹„í™œì„±í™” (ì‚­ì œ ì¶©ëŒ ë°©ì§€)
            // ë°ì´í„° ë¡œë“œëŠ” window.onloadì—ì„œ ìˆ˜í–‰
            // db.ref('manufacturing').on('value', () => { loadManufacturingList(); updateInboundProductSelect(); });
            // db.ref('batches').on('value', () => { updateBatchList(); updateInboundList(); updateInventory(); });
            // db.ref('transactions').on('value', () => { updateOutboundList(); updateInventory(); });
            // db.ref('haccp').on('value', () => { updateHACCPList(); });
        } catch (error) {
            isFirebaseEnabled = false;
            updateConnectionStatus(false);
        }
        
        let manufacturingData = {};
        let batches = {};
        let transactions = [];
        let haccpData = [];
        let selectedColor = '';
        let selectedZone = '';
        let selectedBatchId = '';
        let editingMfgId = null;
        let editingHaccpId = null;
        let currentMfgPhoto = null;
        
        function compressImage(file, maxSizeKB = 200) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        const maxDimension = 800;
                        if (width > height && width > maxDimension) {
                            height = (height / width) * maxDimension;
                            width = maxDimension;
                        } else if (height > maxDimension) {
                            width = (width / height) * maxDimension;
                            height = maxDimension;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        let quality = 0.7;
                        let compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                        
                        while (compressedDataUrl.length > maxSizeKB * 1024 * 1.37 && quality > 0.1) {
                            quality -= 0.1;
                            compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                        }
                        
                        resolve(compressedDataUrl);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // ğŸ”¥ Firebase Storageì— ì‚¬ì§„ ì—…ë¡œë“œ
        async function uploadPhotoToStorage(file, path) {
            try {
                // 1. íŒŒì¼ëª… ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ + ì›ë³¸ í™•ì¥ì)
                const timestamp = Date.now();
                const ext = file.name.split('.').pop();
                const fileName = `${path}_${timestamp}.${ext}`;
                
                // 2. Storage ê²½ë¡œ: photos/ì œì¡°/íŒŒì¼ëª…, photos/ì…ê³ /íŒŒì¼ëª… ë“±
                const storageRef = storage.ref(`photos/${path}/${fileName}`);
                
                // 3. ì—…ë¡œë“œ (ë©”íƒ€ë°ì´í„° í¬í•¨)
                const metadata = {
                    contentType: file.type,
                    customMetadata: {
                        'uploadedAt': new Date().toISOString()
                    }
                };
                
                showNotification('ğŸ“¤ ì‚¬ì§„ ì—…ë¡œë“œ ì¤‘...', 'info');
                const snapshot = await storageRef.put(file, metadata);
                
                // 4. ë‹¤ìš´ë¡œë“œ URL ê°€ì ¸ì˜¤ê¸°
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                showNotification('âœ… ì‚¬ì§„ ì—…ë¡œë“œ ì™„ë£Œ!', 'success');
                return downloadURL;
                
            } catch (error) {
                console.error('ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                showNotification('âš ï¸ ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨! Base64ë¡œ ì €ì¥í•©ë‹ˆë‹¤.', 'warning');
                
                // ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ Base64ë¡œ í´ë°±
                return await compressImage(file, 200);
            }
        }
        
        function quickFillMfgNumber() {
            const today = new Date();
            const yy = String(today.getFullYear()).slice(-2);
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            
            const todayMfgs = Object.values(manufacturingData).filter(m => 
                m.mfgNumber && m.mfgNumber.includes(`${yy}${mm}${dd}`)
            );
            const serial = String(todayMfgs.length + 1).padStart(2, '0');
            
            document.getElementById('mfgNumber').value = `HE-OGP-${yy}${mm}${dd}-${serial}`;
            showNotification('âœ… ì œì¡°ë²ˆí˜¸ ìë™ ì…ë ¥!', 'success');
        }
        
        function quickFillRawBatch() {
            const today = new Date();
            const yy = String(today.getFullYear()).slice(-2);
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            
            document.getElementById('mfgRawBatch').value = `OGP-${yy}${mm}${dd}-A`;
            showNotification('âœ… ì›ì¬ë£Œ ë°°ì¹˜ë²ˆí˜¸ ìë™ ì…ë ¥!', 'success');
        }
        
        function quickSelectProduct(productName, volume) {
            document.getElementById('mfgProductName').value = productName;
            document.getElementById('mfgVolume').value = volume;
            
            document.querySelectorAll('.quick-select-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            showNotification(`âœ… ${productName} (${volume}) ì„ íƒ!`, 'success');
        }
        
        function quickFillBatchNumber() {
            const today = new Date();
            const yy = String(today.getFullYear()).slice(-2);
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            
            const todayBatches = Object.values(batches).filter(b => 
                b.batchNumber && b.batchNumber.includes(`${yy}${mm}${dd}`)
            );
            const suffix = String.fromCharCode(65 + todayBatches.length);
            
            document.getElementById('inboundBatch').value = `OGP-${yy}${mm}${dd}-${suffix}`;
            showNotification('âœ… ë°°ì¹˜ë²ˆí˜¸ ìë™ ì…ë ¥!', 'success');
        }
        
        function quickFillHACCPStandard() {
            document.getElementById('haccpStandard').value = '18~22Â°C ìœ ì§€';
            showNotification('âœ… HACCP ê¸°ì¤€ ìë™ ì…ë ¥!', 'success');
        }
        
        function selectPrice(price) {
            document.getElementById('outboundPrice').value = price;
            
            document.querySelectorAll('.price-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            calculateOutboundTotal();
            showNotification(`âœ… ì¶œê³ ê°€ ${price.toLocaleString()}ì› ì„ íƒ!`, 'success');
        }
        
        function updateConnectionStatus(online) {
            const statusEl = document.getElementById('connectionStatus');
            if (online) {
                statusEl.textContent = 'ğŸŒ ì˜¨ë¼ì¸';
                statusEl.className = 'connection-status status-online';
            } else {
                statusEl.textContent = 'ğŸ“¡ ì˜¤í”„ë¼ì¸';
                statusEl.className = 'connection-status status-offline';
            }
        }
        
        function showAutoSave() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'inbound') {
                updateInboundProductSelect();
                updateInboundList();
            } else if (tabName === 'outbound') {
                updateBatchList();
                updateOutboundList();
            } else if (tabName === 'inventory') {
                updateInventory();
            } else if (tabName === 'haccp') {
                updateHACCPList();
            }
        }
        
        async function handleMfgPhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                try {
                    showNotification('ğŸ“¸ ì‚¬ì§„ ì••ì¶• ì¤‘...', 'success');
                    currentMfgPhoto = await compressImage(file, 200);
                    
                    const preview = document.getElementById('mfgPhotoPreview');
                    preview.src = currentMfgPhoto;
                    preview.classList.add('show');
                    
                    showNotification('âœ… ì‚¬ì§„ ì¤€ë¹„ ì™„ë£Œ!', 'success');
                } catch (error) {
                    showNotification('âŒ ì‚¬ì§„ ì²˜ë¦¬ ì‹¤íŒ¨', 'error');
                }
            }
        }
        
        async function saveManufacturing() {
            const mfgNumber = document.getElementById('mfgNumber').value.trim();
            const mfgDate = document.getElementById('mfgDate').value;
            const productName = document.getElementById('mfgProductName').value.trim();
            const volume = document.getElementById('mfgVolume').value.trim();
            const quantity = document.getElementById('mfgQuantity').value;
            
            if (!mfgNumber || !mfgDate || !productName || !volume || !quantity) {
                showNotification('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!', 'error');
                return;
            }
            
            const mfgId = editingMfgId || ('MFG' + Date.now());
            
            const data = {
                id: mfgId,
                mfgNumber: mfgNumber,
                date: mfgDate,
                productName: productName,
                volume: volume,
                quantity: parseInt(quantity),
                rawBatch: document.getElementById('mfgRawBatch').value,
                alcohol: document.getElementById('mfgAlcohol').value,
                bottlingDate: document.getElementById('mfgBottlingDate').value,
                expiryDate: document.getElementById('mfgExpiryDate').value,
                note: document.getElementById('mfgNote').value,
                photo: currentMfgPhoto || '',
                createdAt: editingMfgId ? manufacturingData[editingMfgId].createdAt : Date.now(),
                updatedAt: Date.now()
            };
            
            if (isFirebaseEnabled) {
                await db.ref('manufacturing/' + mfgId).set(data);
                showAutoSave();
            } else {
                manufacturingData[mfgId] = data;
                localStorage.setItem('manufacturingData', JSON.stringify(manufacturingData));
            }
            
            showNotification(`âœ… ${editingMfgId ? 'ìˆ˜ì •' : 'ë“±ë¡'} ì™„ë£Œ!`, 'success');
            resetManufacturingForm();
            
            // ğŸ”¥ ì „ì—­ ë³€ìˆ˜ ê°•ì œ ë¦¬ë¡œë“œ
            if (isFirebaseEnabled) {
                const snapshot = await db.ref('manufacturing').once('value');
                manufacturingData = snapshot.val() || {};
            }
            
            loadManufacturingList();
            updateInboundProductSelect();
        }
        
        async function loadManufacturingList() {
            if (isFirebaseEnabled) {
                const snapshot = await db.ref('manufacturing').once('value');
                manufacturingData = snapshot.val() || {};
            } else {
                manufacturingData = JSON.parse(localStorage.getItem('manufacturingData') || '{}');
            }
            
            const container = document.getElementById('manufacturingListContainer');
            container.innerHTML = '';
            
            if (Object.keys(manufacturingData).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">ë“±ë¡ëœ ì œì¡° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            const sortedItems = Object.values(manufacturingData).sort((a, b) => b.createdAt - a.createdAt);
            
            sortedItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'manufacturing-item';
                
                const dateTime = new Date(item.createdAt).toLocaleString('ko-KR');
                
                div.innerHTML = `
                    ${item.photo ? `<img src="${item.photo}" class="item-photo" alt="ì‚¬ì§„">` : '<div class="item-photo" style="background: #e2e8f0; display: flex; align-items: center; justify-content: center;">ğŸ“·</div>'}
                    <div class="item-info" onclick="loadManufacturingForEdit('${item.id}')">
                        <h4>${item.mfgNumber}: ${item.productName} (${item.volume})</h4>
                        <p>ì œì¡°ì¼: ${item.date} | ìƒì‚°: ${item.quantity}ë³‘</p>
                        <p>${item.alcohol ? 'ì•Œì½”ì˜¬: ' + item.alcohol : ''} ${item.rawBatch ? '| ì›ì¬ë£Œ: ' + item.rawBatch : ''}</p>
                        <p style="color: #94a3b8;">ë“±ë¡: ${dateTime}</p>
                    </div>
                    <button class="btn btn-danger delete-btn" onclick="deleteManufacturing('${item.id}', this)">ğŸ—‘ï¸</button>
                `;
                
                container.appendChild(div);
            });
        }
        
        async function deleteManufacturing(mfgId, element) {
            if (window.event) {
                window.event.stopPropagation();
            }
            
            if (!confirm('ì •ë§ ì´ ì œì¡° í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            if (isFirebaseEnabled) {
                await db.ref('manufacturing/' + mfgId).remove();
                showAutoSave();
            } else {
                delete manufacturingData[mfgId];
                localStorage.setItem('manufacturingData', JSON.stringify(manufacturingData));
            }
            
            showNotification('âœ… ì‚­ì œ ì™„ë£Œ!', 'success');
            
            // ğŸ”¥ ì „ì—­ ë³€ìˆ˜ ê°•ì œ ë¦¬ë¡œë“œ
            if (isFirebaseEnabled) {
                const snapshot = await db.ref('manufacturing').once('value');
                manufacturingData = snapshot.val() || {};
            }
            
            loadManufacturingList();
            updateInboundProductSelect();
        }
        
        function loadManufacturingForEdit(mfgId) {
            const data = manufacturingData[mfgId];
            if (!data) return;
            
            editingMfgId = mfgId;
            
            document.getElementById('mfgNumber').value = data.mfgNumber;
            document.getElementById('mfgDate').value = data.date;
            document.getElementById('mfgProductName').value = data.productName;
            document.getElementById('mfgVolume').value = data.volume;
            document.getElementById('mfgQuantity').value = data.quantity;
            document.getElementById('mfgRawBatch').value = data.rawBatch || '';
            document.getElementById('mfgAlcohol').value = data.alcohol || '';
            document.getElementById('mfgBottlingDate').value = data.bottlingDate || '';
            document.getElementById('mfgExpiryDate').value = data.expiryDate || '';
            document.getElementById('mfgNote').value = data.note || '';
            
            if (data.photo) {
                currentMfgPhoto = data.photo;
                const preview = document.getElementById('mfgPhotoPreview');
                preview.src = data.photo;
                preview.classList.add('show');
            }
            
            document.getElementById('mfgBtnText').textContent = 'âœï¸ ìˆ˜ì •';
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showNotification('âœï¸ ìˆ˜ì • ëª¨ë“œ', 'success');
        }
        
        function resetManufacturingForm() {
            editingMfgId = null;
            currentMfgPhoto = null;
            
            document.getElementById('mfgNumber').value = '';
            document.getElementById('mfgDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('mfgProductName').value = '';
            document.getElementById('mfgVolume').value = '';
            document.getElementById('mfgQuantity').value = '';
            document.getElementById('mfgRawBatch').value = '';
            document.getElementById('mfgAlcohol').value = '';
            document.getElementById('mfgBottlingDate').value = '';
            document.getElementById('mfgExpiryDate').value = '';
            document.getElementById('mfgNote').value = '';
            
            const preview = document.getElementById('mfgPhotoPreview');
            preview.src = '';
            preview.classList.remove('show');
            
            document.getElementById('mfgBtnText').textContent = 'ğŸ“‹ ì œì¡° ë“±ë¡';
        }
        
        function updateInboundProductSelect() {
            const select = document.getElementById('inboundProduct');
            select.innerHTML = '<option value="">-- ì œì¡°ëœ ìƒí’ˆ ì„ íƒ --</option>';
            
            Object.values(manufacturingData).forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.productName} (${item.volume}) - ${item.mfgNumber}`;
                select.appendChild(option);
            });
        }
        
        function loadProductPhoto() {
            const mfgId = document.getElementById('inboundProduct').value;
            const preview = document.getElementById('inboundPhotoPreview');
            
            if (mfgId && manufacturingData[mfgId] && manufacturingData[mfgId].photo) {
                preview.src = manufacturingData[mfgId].photo;
                preview.classList.add('show');
            } else {
                preview.src = '';
                preview.classList.remove('show');
            }
        }
        
        function selectColor(color) {
            document.querySelectorAll('.color-tape').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedColor = color;
        }
        
        function selectZone(zone) {
            document.querySelectorAll('.warehouse-zone').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedZone = zone;
        }
        
        async function saveInbound() {
            const mfgId = document.getElementById('inboundProduct').value;
            const quantity = document.getElementById('inboundQuantity').value;
            const note = document.getElementById('inboundNote').value;
            const batchInput = document.getElementById('inboundBatch').value.trim();
            
            if (!mfgId || !selectedColor || !selectedZone || !quantity) {
                showNotification('âš ï¸ ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”!', 'error');
                return;
            }
            
            let batchNumber = batchInput;
            if (!batchNumber) {
                const today = new Date();
                const yy = String(today.getFullYear()).slice(-2);
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                const dateStr = `${yy}${mm}${dd}`;
                
                const todayBatches = Object.values(batches).filter(b => 
                    b.batchNumber && b.batchNumber.includes(dateStr)
                );
                const suffix = String.fromCharCode(65 + todayBatches.length);
                batchNumber = `OGP-${dateStr}-${suffix}`;
            }
            
            const mfgData = manufacturingData[mfgId];
            const uniqueId = 'BATCH' + Date.now();
            
            const batchData = {
                id: uniqueId,
                batchNumber: batchNumber,
                mfgId: mfgId,
                mfgNumber: mfgData.mfgNumber,
                productName: mfgData.productName,
                volume: mfgData.volume,
                photo: mfgData.photo || '',
                color: selectedColor,
                zone: selectedZone,
                quantity: parseInt(quantity),
                originalQuantity: parseInt(quantity),
                note: note,
                inboundDate: new Date().toISOString().split('T')[0],
                createdAt: Date.now()
            };
            
            if (isFirebaseEnabled) {
                await db.ref('batches/' + uniqueId).set(batchData);
                showAutoSave();
            } else {
                batches[uniqueId] = batchData;
                localStorage.setItem('batches', JSON.stringify(batches));
            }
            
            showNotification(`âœ… ${mfgData.productName} ${quantity}ë³‘ ì…ê³  ì™„ë£Œ!`, 'success');
            resetInboundForm();
            
            // ğŸ”¥ ì „ì—­ ë³€ìˆ˜ ê°•ì œ ë¦¬ë¡œë“œ
            if (isFirebaseEnabled) {
                const batchSnapshot = await db.ref('batches').once('value');
                batches = batchSnapshot.val() || {};
            }
            
            updateInboundList();
            updateBatchList();  // ì¶œê³  í™”ë©´ë„ ì—…ë°ì´íŠ¸
            updateInventory();  // ì¬ê³  í™”ë©´ë„ ì—…ë°ì´íŠ¸
        }
        
        async function updateInboundList() {
            if (isFirebaseEnabled) {
                const snapshot = await db.ref('batches').once('value');
                batches = snapshot.val() || {};
            } else {
                batches = JSON.parse(localStorage.getItem('batches') || '{}');
            }
            
            const container = document.getElementById('inboundListContainer');
            container.innerHTML = '';
            
            const batchList = Object.values(batches);
            
            if (batchList.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">ì…ê³  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            const sortedBatches = batchList.sort((a, b) => b.createdAt - a.createdAt);
            
            sortedBatches.forEach(batch => {
                const div = document.createElement('div');
                div.className = 'manufacturing-item';
                
                const dateTime = new Date(batch.createdAt).toLocaleString('ko-KR');
                
                div.innerHTML = `
                    ${batch.photo ? `<img src="${batch.photo}" class="item-photo" alt="ì‚¬ì§„">` : '<div class="item-photo" style="background: #e2e8f0; display: flex; align-items: center; justify-content: center;">ğŸ“·</div>'}
                    <div class="item-info" onclick="loadInboundForEdit('${batch.id}')">
                        <h4>${batch.productName} (${batch.volume})</h4>
                        <p>ë°°ì¹˜: ${batch.batchNumber} | ì œì¡°: ${batch.mfgNumber}</p>
                        <p>ì…ê³ : ${batch.originalQuantity}ë³‘ | í˜„ì¬ê³ : ${batch.quantity}ë³‘</p>
                        <p>ìƒ‰ìƒ: ${batch.color} | êµ¬ì—­: ${batch.zone}</p>
                        <p style="color: #94a3b8;">ì…ê³ ì¼: ${batch.inboundDate} | ë“±ë¡: ${dateTime}</p>
                        ${batch.note ? '<p style="color: #64748b;">ë¹„ê³ : ' + batch.note + '</p>' : ''}
                    </div>
                    <button class="btn btn-danger delete-btn" onclick="deleteBatch('${batch.id}', this)">ğŸ—‘ï¸</button>
                `;
                
                container.appendChild(div);
            });
        }
        
        async function deleteBatch(batchId, element) {
            if (window.event) {
                window.event.stopPropagation();
            }
            
            if (!confirm('ì •ë§ ì´ ì…ê³  í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ ì¶œê³  ì´ë ¥ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            
            // ì œì¡° ì‚­ì œì²˜ëŸ¼ ë‹¨ìˆœí•˜ê²Œ!
            if (isFirebaseEnabled) {
                await db.ref('batches/' + batchId).remove();
                
                const transSnapshot = await db.ref('transactions').once('value');
                const transData = transSnapshot.val() || {};
                for (let key in transData) {
                    if (transData[key].batchId === batchId) {
                        await db.ref('transactions/' + key).remove();
                    }
                }
                showAutoSave();
            } else {
                delete batches[batchId];
                localStorage.setItem('batches', JSON.stringify(batches));
                
                transactions = transactions.filter(t => t.batchId !== batchId);
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }
            
            showNotification('âœ… ì‚­ì œ ì™„ë£Œ!', 'success');
            
            // ğŸ”¥ ì „ì—­ ë³€ìˆ˜ ê°•ì œ ë¦¬ë¡œë“œ
            if (isFirebaseEnabled) {
                const batchSnapshot = await db.ref('batches').once('value');
                batches = batchSnapshot.val() || {};
                const transSnapshot = await db.ref('transactions').once('value');
                transactions = Object.values(transSnapshot.val() || {});
            }
            
            // ğŸ”¥ ëª¨ë“  ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ awaitë¡œ ê¸°ë‹¤ë¦¼!
            await updateInboundList();
            await updateInventory();
            await updateBatchList();
            await updateOutboundList();
        }
        
        function loadInboundForEdit(batchId) {
            const batch = batches[batchId];
            if (!batch) return;
            
            document.getElementById('inboundProduct').value = batch.mfgId;
            loadProductPhoto();
            document.getElementById('inboundBatch').value = batch.batchNumber;
            document.getElementById('inboundQuantity').value = batch.originalQuantity;
            document.getElementById('inboundNote').value = batch.note || '';
            
            selectedColor = batch.color;
            document.querySelectorAll('.color-tape').forEach(el => {
                if (el.textContent.includes(batch.color) || el.onclick.toString().includes(batch.color)) {
                    el.classList.add('selected');
                } else {
                    el.classList.remove('selected');
                }
            });
            
            selectedZone = batch.zone;
            document.querySelectorAll('.warehouse-zone').forEach(el => {
                if (el.textContent.includes(batch.zone) || el.onclick.toString().includes(batch.zone)) {
                    el.classList.add('selected');
                } else {
                    el.classList.remove('selected');
                }
            });
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showNotification('âœ… ì…ê³  ë°ì´í„° ë¡œë“œ!', 'success');
        }
        
        function resetInboundForm() {
            document.getElementById('inboundProduct').value = '';
            document.getElementById('inboundQuantity').value = '';
            document.getElementById('inboundNote').value = '';
            document.getElementById('inboundBatch').value = '';
            document.getElementById('inboundPhotoPreview').classList.remove('show');
            selectedColor = '';
            selectedZone = '';
            document.querySelectorAll('.color-tape').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.warehouse-zone').forEach(el => el.classList.remove('selected'));
        }
        
        async function updateBatchList() {
            if (isFirebaseEnabled) {
                const snapshot = await db.ref('batches').once('value');
                batches = snapshot.val() || {};
            } else {
                batches = JSON.parse(localStorage.getItem('batches') || '{}');
            }
            
            const select = document.getElementById('batchSelect');
            select.innerHTML = '<option value="">-- ì¬ê³ ê°€ ìˆëŠ” ë°°ì¹˜ ì„ íƒ --</option>';
            
            const availableBatches = Object.values(batches).filter(b => b.quantity > 0);
            
            availableBatches.forEach(batch => {
                const option = document.createElement('option');
                option.value = batch.id;
                option.textContent = `${batch.batchNumber} | ${batch.productName} (${batch.volume}) | ì¬ê³ : ${batch.quantity}ë³‘`;
                select.appendChild(option);
            });
        }
        
        function selectBatchFromDropdown() {
            const select = document.getElementById('batchSelect');
            selectedBatchId = select.value;
            
            if (selectedBatchId) {
                const batch = batches[selectedBatchId];
                document.getElementById('selectedBatchInfo').style.display = 'block';
                document.getElementById('selectedBatchName').textContent = `${batch.batchNumber} | ${batch.productName} (${batch.volume})`;
                document.getElementById('selectedBatchStock').textContent = batch.quantity;
            } else {
                document.getElementById('selectedBatchInfo').style.display = 'none';
            }
        }
        
        function calculateOutboundTotal() {
            const quantity = parseInt(document.getElementById('outboundQuantity').value) || 0;
            const price = parseInt(document.getElementById('outboundPrice').value) || 0;
            const total = quantity * price;
            
            document.getElementById('outboundTotal').value = total.toLocaleString() + 'ì›';
        }
        
        async function saveOutbound() {
            if (!selectedBatchId) {
                showNotification('âš ï¸ ë°°ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”!', 'error');
                return;
            }
            
            const quantity = parseInt(document.getElementById('outboundQuantity').value);
            const target = document.getElementById('outboundTarget').value.trim();
            const price = parseInt(document.getElementById('outboundPrice').value);
            const note = document.getElementById('outboundNote').value.trim();
            
            if (!quantity || !target || !price) {
                showNotification('âš ï¸ ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”!', 'error');
                return;
            }
            
            const batch = batches[selectedBatchId];
            
            if (quantity > batch.quantity) {
                showNotification(`âš ï¸ ì¬ê³  ë¶€ì¡±! (í˜„ì¬ ì¬ê³ : ${batch.quantity}ë³‘)`, 'error');
                return;
            }
            
            const total = quantity * price;
            
            const transaction = {
                id: 'OUT' + Date.now(),
                batchId: selectedBatchId,
                batchNumber: batch.batchNumber,
                mfgId: batch.mfgId,
                mfgNumber: batch.mfgNumber,
                productName: batch.productName,
                volume: batch.volume,
                photo: batch.photo,
                quantity: quantity,
                target: target,
                price: price,
                total: total,
                note: note,
                color: batch.color,
                zone: batch.zone,
                outboundDate: new Date().toISOString().split('T')[0],
                createdAt: Date.now()
            };
            
            batch.quantity -= quantity;
            
            if (isFirebaseEnabled) {
                await db.ref('batches/' + selectedBatchId).set(batch);
                await db.ref('transactions/' + transaction.id).set(transaction);
                showAutoSave();
            } else {
                batches[selectedBatchId] = batch;
                transactions.push(transaction);
                localStorage.setItem('batches', JSON.stringify(batches));
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }
            
            showNotification(`âœ… ${quantity}ë³‘ ì¶œê³  ì™„ë£Œ! (${total.toLocaleString()}ì›)`, 'success');
            
            document.getElementById('outboundQuantity').value = '';
            document.getElementById('outboundTarget').value = '';
            document.getElementById('outboundPrice').value = '';
            document.getElementById('outboundTotal').value = '';
            document.getElementById('outboundNote').value = '';
            document.getElementById('batchSelect').value = '';
            document.getElementById('selectedBatchInfo').style.display = 'none';
            selectedBatchId = '';
            
            updateBatchList();
            updateOutboundList();
        }
        
        async function updateOutboundList() {
            if (isFirebaseEnabled) {
                const transSnapshot = await db.ref('transactions').once('value');
                const transData = transSnapshot.val() || {};
                transactions = Object.values(transData);
            } else {
                transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            }
            
            const container = document.getElementById('outboundListContainer');
            container.innerHTML = '';
            
            if (transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">ì¶œê³  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            const sortedTrans = transactions.sort((a, b) => b.createdAt - a.createdAt);
            
            sortedTrans.forEach(trans => {
                const div = document.createElement('div');
                div.className = 'manufacturing-item';
                
                const dateTime = new Date(trans.createdAt).toLocaleString('ko-KR');
                
                div.innerHTML = `
                    ${trans.photo ? `<img src="${trans.photo}" class="item-photo" alt="ì‚¬ì§„">` : '<div class="item-photo" style="background: #e2e8f0; display: flex; align-items: center; justify-content: center;">ğŸ“·</div>'}
                    <div class="item-info">
                        <h4>${trans.productName} (${trans.volume})</h4>
                        <p>ì¶œê³ ì²˜: <strong>${trans.target}</strong> | ìˆ˜ëŸ‰: ${trans.quantity}ë³‘ | ë‹¨ê°€: ${trans.price.toLocaleString()}ì›</p>
                        <p>ì´ì•¡: <strong>${trans.total.toLocaleString()}ì›</strong> | ë°°ì¹˜: ${trans.batchNumber}</p>
                        <p>ì œì¡°: ${trans.mfgNumber} | ìƒ‰ìƒ: ${trans.color} | êµ¬ì—­: ${trans.zone}</p>
                        ${trans.note ? '<p style="color: #64748b;">ë¹„ê³ : ' + trans.note + '</p>' : ''}
                        <p style="color: #94a3b8;">ì¶œê³ ì¼: ${trans.outboundDate} | ë“±ë¡: ${dateTime}</p>
                    </div>
                    <button class="btn btn-danger delete-btn" onclick="deleteTransaction('${trans.id}', this)">ğŸ—‘ï¸</button>
                `;
                
                container.appendChild(div);
            });
        }
        
        async function deleteTransaction(transId, element) {
            if (window.event) {
                window.event.stopPropagation();
            }
            
            if (!confirm('ì •ë§ ì´ ì¶œê³  í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì¬ê³ ëŠ” ë³µêµ¬ë©ë‹ˆë‹¤.')) return;
            
            const trans = transactions.find(t => t.id === transId);
            if (!trans) return;
            
            const batch = batches[trans.batchId];
            if (batch) {
                batch.quantity += trans.quantity;
            }
            
            if (isFirebaseEnabled) {
                if (batch) await db.ref('batches/' + trans.batchId).set(batch);
                await db.ref('transactions/' + transId).remove();
                showAutoSave();
            } else {
                if (batch) {
                    batches[trans.batchId] = batch;
                    localStorage.setItem('batches', JSON.stringify(batches));
                }
                transactions = transactions.filter(t => t.id !== transId);
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }
            
            showNotification('âœ… ì‚­ì œ ì™„ë£Œ! ì¬ê³  ë³µêµ¬ë¨', 'success');
            
            // ğŸ”¥ ì „ì—­ ë³€ìˆ˜ ê°•ì œ ë¦¬ë¡œë“œ
            if (isFirebaseEnabled) {
                const batchSnapshot = await db.ref('batches').once('value');
                batches = batchSnapshot.val() || {};
                const transSnapshot = await db.ref('transactions').once('value');
                transactions = Object.values(transSnapshot.val() || {});
            }
            
            updateOutboundList();
            updateInventory();
            updateBatchList();
        }
        
        async function updateInventory() {
            if (isFirebaseEnabled) {
                const batchSnapshot = await db.ref('batches').once('value');
                batches = batchSnapshot.val() || {};
                
                const transSnapshot = await db.ref('transactions').once('value');
                const transData = transSnapshot.val() || {};
                transactions = Object.values(transData);
            } else {
                batches = JSON.parse(localStorage.getItem('batches') || '{}');
                transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            }
            
            const batchList = Object.values(batches);
            
            let totalInbound = 0;
            let totalStock = 0;
            let totalOutbound = 0;
            let totalSales = 0;
            
            batchList.forEach(batch => {
                totalInbound += batch.originalQuantity;
                totalStock += batch.quantity;
            });
            
            transactions.forEach(trans => {
                totalOutbound += trans.quantity;
                totalSales += trans.total;
            });
            
            document.getElementById('summaryInbound').textContent = totalInbound + 'ë³‘';
            document.getElementById('summaryStock').textContent = totalStock + 'ë³‘';
            document.getElementById('summaryOutbound').textContent = totalOutbound + 'ë³‘';
            document.getElementById('summarySales').textContent = totalSales.toLocaleString() + 'ì›';
            
            const tbody = document.getElementById('inventoryBody');
            tbody.innerHTML = '';
            
            if (batchList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" style="text-align: center; padding: 30px;">ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }
            
            const sortedBatches = batchList.sort((a, b) => b.createdAt - a.createdAt);
            
            sortedBatches.forEach(batch => {
                const batchTransactions = transactions.filter(t => t.batchId === batch.id);
                
                const totalOut = batchTransactions.reduce((sum, t) => sum + t.quantity, 0);
                const totalSales = batchTransactions.reduce((sum, t) => sum + t.total, 0);
                const targets = batchTransactions.map(t => `${t.target}(${t.quantity}ë³‘)`).join(', ');
                
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${batch.photo ? `<img src="${batch.photo}" class="product-photo-small" alt="ì‚¬ì§„">` : 'ğŸ“·'}</td>
                    <td>${batch.productName} (${batch.volume})</td>
                    <td>${batch.mfgNumber}</td>
                    <td>${batch.batchNumber}</td>
                    <td><strong>${batch.originalQuantity}ë³‘</strong></td>
                    <td><strong style="color: #10b981;">${batch.quantity}ë³‘</strong></td>
                    <td><strong style="color: #ef4444;">${totalOut}ë³‘</strong></td>
                    <td style="font-size: 12px;">${targets || '-'}</td>
                    <td><strong style="color: #667eea;">${totalSales.toLocaleString()}ì›</strong></td>
                    <td>${batch.inboundDate}</td>
                    <td>${batch.color} / ${batch.zone}</td>
                    <td><button class="btn btn-danger" onclick="deleteBatchFromInventory('${batch.id}', this)">ğŸ—‘ï¸</button></td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        async function deleteBatchFromInventory(batchId, element) {
            if (window.event) {
                window.event.stopPropagation();
            }
            
            if (!confirm('ì •ë§ ì´ ì¬ê³  í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ ì¶œê³  ì´ë ¥ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            
            // ì¶œê³  ì‚­ì œì²˜ëŸ¼ ë‹¨ìˆœí•˜ê²Œ!
            if (isFirebaseEnabled) {
                await db.ref('batches/' + batchId).remove();
                
                const transSnapshot = await db.ref('transactions').once('value');
                const transData = transSnapshot.val() || {};
                for (let key in transData) {
                    if (transData[key].batchId === batchId) {
                        await db.ref('transactions/' + key).remove();
                    }
                }
                showAutoSave();
            } else {
                delete batches[batchId];
                localStorage.setItem('batches', JSON.stringify(batches));
                
                transactions = transactions.filter(t => t.batchId !== batchId);
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }
            
            showNotification('âœ… ì‚­ì œ ì™„ë£Œ!', 'success');
            
            // ğŸ”¥ ì „ì—­ ë³€ìˆ˜ ê°•ì œ ë¦¬ë¡œë“œ
            if (isFirebaseEnabled) {
                const batchSnapshot = await db.ref('batches').once('value');
                batches = batchSnapshot.val() || {};
                const transSnapshot = await db.ref('transactions').once('value');
                transactions = Object.values(transSnapshot.val() || {});
            }
            
            // ğŸ”¥ ëª¨ë“  ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ awaitë¡œ ê¸°ë‹¤ë¦¼!
            await updateInboundList();
            await updateOutboundList();
            await updateInventory();
            await updateBatchList();
        }
        
        async function saveHACCP() {
            const date = document.getElementById('haccpDate').value;
            const stage = document.getElementById('haccpStage').value;
            const item = document.getElementById('haccpItem').value;
            const standard = document.getElementById('haccpStandard').value;
            const result = document.getElementById('haccpResult').value;
            const action = document.getElementById('haccpAction').value;
            const inspector = document.getElementById('haccpInspector').value;
            
            if (!date || !standard || !inspector) {
                showNotification('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!', 'error');
                return;
            }
            
            const haccpId = editingHaccpId || ('HACCP' + Date.now());
            
            const data = {
                id: haccpId,
                date: date,
                stage: stage,
                item: item,
                standard: standard,
                result: result,
                action: action,
                inspector: inspector,
                createdAt: editingHaccpId ? haccpData.find(h => h.id === haccpId).createdAt : Date.now(),
                updatedAt: Date.now()
            };
            
            if (isFirebaseEnabled) {
                await db.ref('haccp/' + haccpId).set(data);
                showAutoSave();
            } else {
                if (editingHaccpId) {
                    haccpData = haccpData.map(h => h.id === haccpId ? data : h);
                } else {
                    haccpData.push(data);
                }
                localStorage.setItem('haccpData', JSON.stringify(haccpData));
            }
            
            showNotification(`âœ… HACCP ${editingHaccpId ? 'ìˆ˜ì •' : 'ë“±ë¡'} ì™„ë£Œ!`, 'success');
            resetHACCPForm();
            updateHACCPList();
        }
        
        async function updateHACCPList() {
            if (isFirebaseEnabled) {
                const snapshot = await db.ref('haccp').once('value');
                const data = snapshot.val() || {};
                haccpData = Object.values(data);
            } else {
                haccpData = JSON.parse(localStorage.getItem('haccpData') || '[]');
            }
            
            const container = document.getElementById('haccpListContainer');
            container.innerHTML = '';
            
            if (haccpData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">HACCP ì ê²€ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            const sortedData = haccpData.sort((a, b) => b.createdAt - a.createdAt);
            
            sortedData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'manufacturing-item';
                
                const dateTime = new Date(item.createdAt).toLocaleString('ko-KR');
                const resultIcon = item.result === 'ì í•©' ? 'âœ…' : 'âŒ';
                const resultColor = item.result === 'ì í•©' ? '#10b981' : '#ef4444';
                
                div.innerHTML = `
                    <div style="width: 60px; height: 60px; background: ${resultColor}; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                        ${resultIcon}
                    </div>
                    <div class="item-info" onclick="loadHACCPForEdit('${item.id}')">
                        <h4>${item.date} | ${item.stage} - ${item.item}</h4>
                        <p>ê¸°ì¤€: ${item.standard}</p>
                        <p>ê²°ê³¼: <strong style="color: ${resultColor};">${item.result}</strong> | ì ê²€ì: ${item.inspector}</p>
                        ${item.action ? '<p style="color: #64748b;">ì¡°ì¹˜: ' + item.action + '</p>' : ''}
                        <p style="color: #94a3b8;">ë“±ë¡: ${dateTime}</p>
                    </div>
                    <button class="btn btn-danger delete-btn" onclick="deleteHACCP('${item.id}', this)">ğŸ—‘ï¸</button>
                `;
                
                container.appendChild(div);
            });
        }
        
        function loadHACCPForEdit(haccpId) {
            const data = haccpData.find(h => h.id === haccpId);
            if (!data) return;
            
            editingHaccpId = haccpId;
            
            document.getElementById('haccpDate').value = data.date;
            document.getElementById('haccpStage').value = data.stage;
            document.getElementById('haccpItem').value = data.item;
            document.getElementById('haccpStandard').value = data.standard;
            document.getElementById('haccpResult').value = data.result;
            document.getElementById('haccpAction').value = data.action || '';
            document.getElementById('haccpInspector').value = data.inspector;
            
            document.getElementById('haccpBtnText').textContent = 'âœï¸ ìˆ˜ì • ì €ì¥';
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showNotification('âœï¸ ìˆ˜ì • ëª¨ë“œ', 'success');
        }
        
        async function deleteHACCP(haccpId, element) {
            if (window.event) {
                window.event.stopPropagation();
            }
            
            if (!confirm('ì •ë§ ì´ HACCP ì ê²€ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            if (isFirebaseEnabled) {
                await db.ref('haccp/' + haccpId).remove();
                showAutoSave();
            } else {
                haccpData = haccpData.filter(h => h.id !== haccpId);
                localStorage.setItem('haccpData', JSON.stringify(haccpData));
            }
            
            showNotification('âœ… ì‚­ì œ ì™„ë£Œ!', 'success');
            updateHACCPList();
        }
        
        function resetHACCPForm() {
            editingHaccpId = null;
            document.getElementById('haccpDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('haccpStage').value = 'ë°œíš¨ê³µì •';
            document.getElementById('haccpItem').value = 'ì˜¨ë„ê´€ë¦¬';
            document.getElementById('haccpStandard').value = '';
            document.getElementById('haccpResult').value = 'ì í•©';
            document.getElementById('haccpAction').value = '';
            document.getElementById('haccpInspector').value = '';
            document.getElementById('haccpBtnText').textContent = 'âœ… ì ê²€ ë“±ë¡';
        }
        
        async function exportToExcel() {
            try {
                if (isFirebaseEnabled) {
                    const mfgSnapshot = await db.ref('manufacturing').once('value');
                    manufacturingData = mfgSnapshot.val() || {};
                    
                    const batchSnapshot = await db.ref('batches').once('value');
                    batches = batchSnapshot.val() || {};
                    
                    const transSnapshot = await db.ref('transactions').once('value');
                    const transData = transSnapshot.val() || {};
                    transactions = Object.values(transData);
                    
                    const haccpSnapshot = await db.ref('haccp').once('value');
                    const haccpDataObj = haccpSnapshot.val() || {};
                    haccpData = Object.values(haccpDataObj);
                } else {
                    manufacturingData = JSON.parse(localStorage.getItem('manufacturingData') || '{}');
                    batches = JSON.parse(localStorage.getItem('batches') || '{}');
                    transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
                    haccpData = JSON.parse(localStorage.getItem('haccpData') || '[]');
                }
                
                const wb = XLSX.utils.book_new();
                
                const mfgData = Object.values(manufacturingData).map(item => ({
                    'ì œì¡°ë²ˆí˜¸': item.mfgNumber,
                    'ì œì¡°ì¼ì': item.date,
                    'ìƒí’ˆëª…': item.productName,
                    'ìš©ëŸ‰': item.volume,
                    'ìƒì‚°ìˆ˜ëŸ‰': item.quantity,
                    'ì›ì¬ë£Œë°°ì¹˜': item.rawBatch || '',
                    'ì•Œì½”ì˜¬': item.alcohol || '',
                    'ë³‘ì…ì¼': item.bottlingDate || '',
                    'ì†Œë¹„ê¸°í•œ': item.expiryDate || '',
                    'ë¹„ê³ ': item.note || '',
                    'ë“±ë¡ì¼ì‹œ': new Date(item.createdAt).toLocaleString('ko-KR')
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(mfgData), 'ì œì¡°ê´€ë¦¬ëŒ€ì¥');
                
                const batchData = Object.values(batches).map(item => ({
                    'ë°°ì¹˜ë²ˆí˜¸': item.batchNumber,
                    'ì œì¡°ë²ˆí˜¸': item.mfgNumber,
                    'ìƒí’ˆëª…': item.productName,
                    'ìš©ëŸ‰': item.volume,
                    'ìƒ‰ìƒ': item.color,
                    'êµ¬ì—­': item.zone,
                    'ì…ê³ ìˆ˜ëŸ‰': item.originalQuantity,
                    'í˜„ì¬ê³ ': item.quantity,
                    'ì…ê³ ì¼': item.inboundDate,
                    'ë¹„ê³ ': item.note || '',
                    'ë“±ë¡ì¼ì‹œ': new Date(item.createdAt).toLocaleString('ko-KR')
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(batchData), 'ì…ê³ ë‚´ì—­');
                
                const transData = transactions.map(item => ({
                    'ì¶œê³ ì¼': item.outboundDate,
                    'ë°°ì¹˜ë²ˆí˜¸': item.batchNumber,
                    'ì œì¡°ë²ˆí˜¸': item.mfgNumber,
                    'ìƒí’ˆëª…': item.productName,
                    'ìš©ëŸ‰': item.volume,
                    'ì¶œê³ ìˆ˜ëŸ‰': item.quantity,
                    'ì¶œê³ ì²˜': item.target,
                    'ì¶œê³ ê°€': item.price,
                    'ì´ì•¡': item.total,
                    'ë¹„ê³ ': item.note || '',
                    'ìƒ‰ìƒ': item.color,
                    'êµ¬ì—­': item.zone,
                    'ë“±ë¡ì¼ì‹œ': new Date(item.createdAt).toLocaleString('ko-KR')
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(transData), 'ì¶œê³ ë‚´ì—­');
                
                const inventoryData = Object.values(batches).map(batch => {
                    const batchTrans = transactions.filter(t => t.batchId === batch.id);
                    const totalOut = batchTrans.reduce((sum, t) => sum + t.quantity, 0);
                    const totalSales = batchTrans.reduce((sum, t) => sum + t.total, 0);
                    const targets = batchTrans.map(t => t.target).join(', ');
                    
                    return {
                        'ìƒí’ˆëª…': batch.productName,
                        'ìš©ëŸ‰': batch.volume,
                        'ì œì¡°ë²ˆí˜¸': batch.mfgNumber,
                        'ë°°ì¹˜ë²ˆí˜¸': batch.batchNumber,
                        'ì…ê³ ìˆ˜ëŸ‰': batch.originalQuantity,
                        'í˜„ì¬ê³ ': batch.quantity,
                        'ì¶œê³ ìˆ˜ëŸ‰': totalOut,
                        'ì¶œê³ ëŒ€ìƒ': targets || '-',
                        'íŒë§¤ì´ì•¡': totalSales,
                        'ì…ê³ ì¼': batch.inboundDate,
                        'ìƒ‰ìƒ': batch.color,
                        'êµ¬ì—­': batch.zone
                    };
                });
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(inventoryData), 'ì¬ê³ í˜„í™©');
                
                const haccpExcelData = haccpData.map(item => ({
                    'ì ê²€ì¼': item.date,
                    'ê³µì •ë‹¨ê³„': item.stage,
                    'ì ê²€í•­ëª©': item.item,
                    'ê¸°ì¤€': item.standard,
                    'ì ê²€ê²°ê³¼': item.result,
                    'ì¡°ì¹˜ì‚¬í•­': item.action || '',
                    'ì ê²€ì': item.inspector,
                    'ë“±ë¡ì¼ì‹œ': new Date(item.createdAt).toLocaleString('ko-KR')
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(haccpExcelData), 'HACCPì ê²€í‘œ');
                
                const today = new Date();
                const dateStr = today.toISOString().split('T')[0];
                const fileName = `ì˜¤ê°€í”¼ì™€ì¸_ì œì¡°ê´€ë¦¬_${dateStr}.xlsx`;
                
                XLSX.writeFile(wb, fileName);
                
                showNotification(`âœ… ì—‘ì…€ ì €ì¥ ì™„ë£Œ! (${fileName})`, 'success');
            } catch (error) {
                showNotification('âŒ ì—‘ì…€ ì €ì¥ ì‹¤íŒ¨', 'error');
            }
        }
        
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        

        
        // ğŸ” ê´€ë¦¬ì ì½”ë“œ ì„¤ì •
        const ADMIN_CODE = "ogapiro2025";  // â† ì›í•˜ëŠ” ì½”ë“œë¡œ ë³€ê²½ ê°€ëŠ¥
        const LOGIN_DURATION = 30;  // ë¡œê·¸ì¸ ìœ ì§€ ì¼ìˆ˜
        
        // ì—”í„°í‚¤ë¡œ ë¡œê·¸ì¸
        document.addEventListener('DOMContentLoaded', function() {
            const adminInput = document.getElementById('adminCode');
            if (adminInput) {
                adminInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkAdminCode();
                    }
                });
                adminInput.focus();  // ìë™ í¬ì»¤ìŠ¤
            }
        });
        
        // ë¡œê·¸ì¸ í™•ì¸
        function checkAdminCode() {
            const input = document.getElementById('adminCode');
            const code = input.value.trim();
            const errorMsg = document.getElementById('loginError');
            
            if (code === ADMIN_CODE) {
                // ë¡œê·¸ì¸ ì„±ê³µ!
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + LOGIN_DURATION);
                
                localStorage.setItem('adminLoginExpiry', expiryDate.getTime());
                
                // ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê¸°
                document.getElementById('loginOverlay').style.display = 'none';
                
                showNotification('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                
            } else {
                // ë¡œê·¸ì¸ ì‹¤íŒ¨
                errorMsg.style.display = 'block';
                input.value = '';
                input.focus();
                
                // 3ì´ˆ í›„ ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                }, 3000);
            }
        }
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function checkLoginStatus() {
            const expiry = localStorage.getItem('adminLoginExpiry');
            
            if (expiry && new Date().getTime() < parseInt(expiry)) {
                // ë¡œê·¸ì¸ ìœ íš¨í•¨
                document.getElementById('loginOverlay').style.display = 'none';
                return true;
            } else {
                // ë¡œê·¸ì¸ í•„ìš”
                localStorage.removeItem('adminLoginExpiry');
                document.getElementById('loginOverlay').style.display = 'flex';
                return false;
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ (í•„ìš”ì‹œ ì‚¬ìš©)
        function logout() {
            localStorage.removeItem('adminLoginExpiry');
            location.reload();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ í™•ì¸
        checkLoginStatus();

        window.onload = function() {
            // ğŸ”¥ ì˜ˆì „ í”„ë¡œì íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ!
            localStorage.clear();
            console.log("âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” ì™„ë£Œ!");
            
            loadManufacturingList();
            updateInboundProductSelect();
            updateInboundList();
            updateOutboundList();
            updateInventory();
            updateHACCPList();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('mfgDate').value = today;
            document.getElementById('haccpDate').value = today;
        };
    </script>
</body>
</html>